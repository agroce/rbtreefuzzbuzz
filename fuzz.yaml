base: ubuntu:16.04
setup: # global setup steps here
- sudo apt-get -y update
- sudo apt-get -y install build-essential gcc-multilib cmake python python-pip python-setuptools libffi-dev git
- pip2 install pyflakes --user
- pip2 install angr==7.8.9.26 --user
- pip2 install https://github.com/trailofbits/manticore/archive/last_python2.zip --user
- git clone --single-branch --branch general_fuzzer_interfaces https://github.com/trailofbits/deepstate.git 
- cd deepstate
- mkdir build
- cd build
- BUILD_NOSTATIC=TRUE CC=$FUZZ_CC CXX=$FUZZ_CXX cmake ..
- sudo make install
- cd ../..
environment: # global env vars here
- LIBFUZZER_ABORT_ON_FAIL=TRUE
targets:
- name: rbtree
  language: c++
  setup:
    - $FUZZ_C $CFLAGS -c stack.c container.c red_black_tree.c misc.c
    - $FUZZ_CXX $CXXFLAGS -DHEADLESS deepstate_harness.cpp -ldeepstate $FUZZ_ENGINER -o ./target
    - $FUZZ_CXX $CXXFLAGS ./api.o ./harness.cpp $FUZZ_ENGINE -o ./target
  harness: 
    binary: ./target
  sanitizers:
    address: 
  corpus: ./corpus